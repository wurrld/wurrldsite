<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>wurrld.</title>

  <meta name="description" content="[official wurrld website]">

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <style>
    body { visibility: hidden; }
  </style>

  <link rel="stylesheet" href="global.css?v=1">
  <link rel="stylesheet" href="home.css?v=6.4" onload="document.body.style.visibility='visible'">

  <link rel="icon" type="image/x-icon" href="favicon.iso">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
  <link rel="manifest" href="site.webmanifest">
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#ff0000">
  <meta name="theme-color" content="#ff0000">
</head>

<body>
  <div id="page-wrapper">
    <div class="container">
      <h1 id="main-heading">wurrld.</h1>
    </div>

    <div class="square-wrapper" id="s1" role="link" tabindex="0" data-target="random-wip">
      <div class="square"></div>
      <p>WIP</p>
    </div>

    <div class="square-wrapper" id="s2" role="link" tabindex="0" data-target="random-wip">
      <div class="square"></div>
      <p>WIP</p>
    </div>

    <div class="square-wrapper" id="s3" role="link" tabindex="0" data-target="random-wip">
      <div class="square"></div>
      <p>WIP</p>
    </div>

    <div class="square-wrapper" id="s4" role="link" tabindex="0" data-target="random-wip">
      <div class="square"></div>
      <p>WIP</p>
    </div>
  </div>

  <script>
    const squares = document.querySelectorAll('.square-wrapper');
    const heading = document.getElementById('main-heading');
    const container = document.querySelector('.container');
    const pageWrapper = document.getElementById('page-wrapper');

    const wipPages = ["/oh/", "/aah/", "/gah/", "/wah/"];

    function isOverlap(r1, r2) {
      return !(r1.left > r2.right || r1.right < r2.left || r1.top > r2.bottom || r1.bottom < r2.top);
    }

    function setContainerHeight() {
      container.style.height = `${window.innerHeight}px`;
    }

    function placeHeading() {
      const vh = window.innerHeight;
      const vw = window.innerWidth;
      const headingHeight = heading.offsetHeight;

      heading.style.top = `${(vh / 2) - (headingHeight * 1.2)}px`;
      heading.style.left = `${vw / 2}px`;
      heading.style.transform = "translateX(-50%)";
    }

    function placeSquares() {
      setContainerHeight();
      const vw = window.innerWidth;
      const vh = container.clientHeight;

      const hRect = heading.getBoundingClientRect();
      const headingZone = {
        top: hRect.top - 10,
        bottom: hRect.bottom + 10,
        left: hRect.left - 10,
        right: hRect.right + 10
      };

      const zones = [
        { top: 0, left: 0,    width: vw / 2, height: vh / 2 },
        { top: 0, left: vw/2, width: vw / 2, height: vh / 2 },
        { top: vh/2, left: 0, width: vw / 2, height: vh / 2 },
        { top: vh/2, left: vw/2, width: vw / 2, height: vh / 2 }
      ];

      const placedRects = [];

      squares.forEach((square, i) => {
        const zone = zones[i];

        square.style.visibility = "hidden";

        let w = square.offsetWidth;
        let h = square.offsetHeight;
        const label = square.querySelector('p');
        const labelHeight = label.offsetHeight;

        if (window.matchMedia("(max-width:600px) and (orientation: landscape)").matches) {
          w *= 0.8;
          h *= 0.8;
          square.style.width = `${w}px`;
          square.style.height = `${h}px`;
        }

        let attempts = 0;
        let pos = {};

        do {
          attempts++;

          pos.top = zone.top + Math.random() * (zone.height - h - labelHeight);
          pos.left = zone.left + Math.random() * (zone.width - w);

          pos.top = Math.min(Math.max(pos.top, 0), vh - h - labelHeight);
          pos.left = Math.min(Math.max(pos.left, 0), vw - w);

          const rect = {
            top: pos.top,
            left: pos.left,
            bottom: pos.top + h + labelHeight,
            right: pos.left + w
          };

          const collidesHeading = isOverlap(rect, headingZone);
          const collidesSquares = placedRects.some(r => isOverlap(rect, r));

          if (!collidesHeading && !collidesSquares) {
            placedRects.push(rect);
            square.style.top = `${pos.top}px`;
            square.style.left = `${pos.left}px`;
            square.style.visibility = "visible";
            break;
          }
        } while (attempts < 200);
      });
    }

    function goToRandomWip() {
      const idx = Math.floor(Math.random() * wipPages.length);
      window.location.href = wipPages[idx];
    }

    function attachSquareLinksOnce() {
      squares.forEach((square) => {
        square.addEventListener("click", () => {
          const target = square.dataset.target;

          if (target && target !== "random-wip") {
            window.location.href = target;
            return;
          }

          goToRandomWip();
        });

        square.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            square.click();
          }
        });
      });
    }

    function recalcLayout() {
      placeHeading();
      placeSquares();
      pageWrapper.style.visibility = 'visible';
    }

    document.addEventListener('DOMContentLoaded', () => {
      attachSquareLinksOnce();
      recalcLayout();
    });

    window.addEventListener('resize', recalcLayout);
    window.addEventListener('orientationchange', recalcLayout);
  </script>
</body>
</html>

